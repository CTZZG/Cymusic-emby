# 🧪 阶段三测试指南：Emby配置界面

## 📋 测试清单

### 1. 基础界面测试
- [ ] 启动应用，进入设置界面
- [ ] 滚动到"Emby服务器配置"部分
- [ ] 确认显示"Emby服务器设置"和"Emby连接状态"两个选项
- [ ] 点击"Emby服务器设置"，确认模态框正常弹出

### 2. 配置表单测试
- [ ] **服务器地址输入框**
  - 输入测试：`http://192.168.1.100:8096`
  - 确认占位符显示正确
  - 确认输入内容正常显示
  
- [ ] **用户名输入框**
  - 输入测试用户名
  - 确认自动完成功能关闭
  - 确认大小写敏感
  
- [ ] **密码输入框**
  - 输入测试密码
  - 确认密码被隐藏显示（显示为点或星号）
  - 确认输入正常工作
  
- [ ] **设备ID输入框**
  - 测试留空（应该自动生成）
  - 测试输入自定义ID
  - 确认占位符提示正确
  
- [ ] **歌单上传开关**
  - 测试开关切换
  - 确认状态正确保存

### 3. 按钮功能测试
- [ ] **取消按钮**
  - 点击取消，确认模态框关闭
  - 确认未保存的更改被丢弃
  
- [ ] **测试连接按钮**
  - 输入错误的服务器地址，点击测试
  - 确认显示连接失败提示
  - 输入正确配置，点击测试
  - 确认显示连接成功提示
  
- [ ] **保存按钮**
  - 必填字段为空时，确认按钮被禁用
  - 填写完整信息后，确认按钮可点击
  - 点击保存，确认配置被保存

### 4. 状态显示测试
- [ ] **配置状态**
  - 未配置时显示"未配置"
  - 配置完成后显示"已配置"
  
- [ ] **连接状态**
  - 未连接时显示"未连接"
  - 连接成功后显示"已连接"
  
- [ ] **错误提示**
  - 连接失败时显示错误信息
  - 错误信息清晰易懂

### 5. 数据持久化测试
- [ ] 配置并保存Emby设置
- [ ] 关闭应用并重新启动
- [ ] 确认配置被正确加载
- [ ] 确认状态显示正确

## 🔧 测试用例

### 测试用例1：首次配置
1. 启动应用，进入设置
2. 点击"Emby服务器设置"
3. 填写以下信息：
   - 服务器地址：`http://your-emby-server:8096`
   - 用户名：`your-username`
   - 密码：`your-password`
4. 点击"测试连接"
5. 确认连接成功提示
6. 点击"保存"
7. 确认配置保存成功

### 测试用例2：错误配置处理
1. 打开Emby配置界面
2. 输入错误的服务器地址：`http://invalid-server:8096`
3. 输入正确的用户名和密码
4. 点击"测试连接"
5. 确认显示连接失败错误
6. 修正服务器地址
7. 重新测试连接

### 测试用例3：配置修改
1. 打开已有配置的Emby设置
2. 修改服务器地址
3. 点击"测试连接"验证新配置
4. 点击"保存"更新配置
5. 确认新配置生效

## 🐛 常见问题排查

### 问题1：模态框不显示
- 检查`showEmbyConfig`状态是否正确
- 确认`EmbyConfigModal`组件被正确渲染
- 检查样式是否正确应用

### 问题2：配置不保存
- 检查`useEmbyConfig` hook是否正确导入
- 确认`updateConfig`函数被正确调用
- 检查MMKV存储是否正常工作

### 问题3：连接测试失败
- 确认Emby服务器正在运行
- 检查网络连接
- 验证服务器地址格式
- 确认用户名密码正确

### 问题4：状态显示不正确
- 检查`embyConfig.isConfigured`状态
- 确认配置加载逻辑
- 验证状态更新机制

## 📱 手动测试步骤

### 步骤1：准备测试环境
1. 确保有可访问的Emby服务器
2. 准备有效的用户账号
3. 确认网络连接正常

### 步骤2：执行界面测试
1. 启动CyMusic应用
2. 导航到设置界面
3. 找到Emby配置部分
4. 逐一测试所有功能

### 步骤3：验证数据持久化
1. 配置Emby设置
2. 重启应用
3. 确认配置保持

### 步骤4：测试错误处理
1. 输入无效配置
2. 测试连接
3. 确认错误提示

## ✅ 验收标准

- [ ] 所有界面元素正常显示
- [ ] 所有按钮功能正常工作
- [ ] 配置能够正确保存和加载
- [ ] 连接测试功能正常
- [ ] 错误处理机制完善
- [ ] 用户体验流畅

## 🚀 测试完成后

如果所有测试通过，说明阶段三已经成功完成，可以进入阶段四：状态管理层适配。

如果发现问题，请记录具体的错误信息和重现步骤，以便进行修复。
